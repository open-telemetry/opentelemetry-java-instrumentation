# Weaver Documentation Generation Guide

This project now includes Gradle tasks for generating documentation from weaver model files using
the OpenTelemetry Weaver tool. The model files are currently generated by the gradle task
`./gradlew :instrumentation-docs:runAnalysis`.

The build system automatically finds all instrumentation modules with a `models/` directory and
creates Gradle tasks to generate documentation into a corresponding `docs/` directory.

## Model Directory Structure

Each instrumentation with weaver support will have:

```
instrumentation/<module-name>/
├── models/                       # Scaffolded / Generated by the DocGenerater task
│   ├── registry_manifest.yaml    # Registry metadata and dependencies
│   ├── signals.yaml              # Metrics and spans definitions
│   └── attributes.yaml           # (Optional) Attribute group definitions
└── docs/                         # Generated documentation goes here
    └── README.md                 # Auto-generated
```

## Usage

### Generate Documentation for a Specific Module

```bash
./gradlew generateWeaverDocs-<module-name>

# Example:
./gradlew generateWeaverDocs-activej-http-6.0
```

### Generate Documentation for All Modules

```bash
./gradlew generateAllWeaverDocs
```

### List Available Documentation Tasks

```bash
./gradlew tasks --group=documentation
```

## Requirements

- Docker must be installed and running
- The otel/weaver docker image will be pulled automatically

## Output

Generated documentation will appear in:
- `instrumentation/<module-name>/docs/README.md`

## Manually Adding Weaver Support to a New Module

1. Create a `models/` directory in your instrumentation module
2. Add `registry_manifest.yaml` with metadata and dependencies
3. Add `signals.yaml` to define metrics/spans
4. Add `attributes.yaml` for attributes
5. Run `./gradlew generateWeaverDocs-<your-module-name>`

The build system will automatically detect the new models directory and create the task.

## Further Reading

- [Weaver Documentation](https://github.com/open-telemetry/weaver/tree/main/docs)
- [Weaver Example Project](https://github.com/jerbly/weaver-example)
