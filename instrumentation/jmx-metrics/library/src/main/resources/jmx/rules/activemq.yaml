---
rules:
  - beans:
      - org.apache.activemq:type=Broker,brokerName=*,destinationType=Queue,destinationName=*
      - org.apache.activemq:type=Broker,brokerName=*,destinationType=Topic,destinationName=*
    metricAttribute:
      messaging.destination.name: param(destinationName)
      messaging.system: const(activemq)
      # 'topic' or 'queue'
      activemq.destination.type: lowercase(param(destinationType))
      activemq.broker.name: param(brokerName)
    prefix: activemq.
    mapping:
      # activemq.producer.count
      ProducerCount:
        metric: producer.count
        unit: "{producer}"
        type: updowncounter
        desc: The number of producers attached to this destination
      # activemq.consumer.count
      ConsumerCount:
        metric: consumer.count
        unit: "{consumer}"
        type: updowncounter
        desc: The number of consumers subscribed to this destination
      MemoryPercentUsage:
        metric: memory.MemoryPercentUsage
        unit: "%"
        type: gauge
        desc: The percentage of configured memory used
      QueueSize:
        metric: message.queue.size
        unit: "{message}"
        type: updowncounter
        desc: The current number of messages waiting to be consumed
      # activemq.message.expired
      ExpiredCount:
        metric: message.expired
        unit: "{message}"
        type: counter
        desc: The number of messages not delivered because they expired
      # activemq.message.enqueued
      EnqueueCount:
        metric: message.enqueued
        unit: "{message}"
        type: counter
        desc: The number of messages sent to this destination
      # activemq.message.dequeued
      DequeueCount:
        metric: message.dequeued
        unit: "{message}"
        type: counter
        desc: The number of messages acknowledged and removed from this destination
      AverageEnqueueTime:
        metric: message.AverageEnqueueTime
        unit: ms
        type: gauge
        desc: The average time a message was held on this destination

  - bean: org.apache.activemq:type=Broker,brokerName=*
    metricAttribute:
      broker: param(brokerName)
    prefix: activemq.
    unit: "%"
    type: gauge
    mapping:
      CurrentConnectionsCount:
        metric: connections.CurrentConnectionsCount
        type: updowncounter
        unit: "{connections}"
        desc: The total number of current connections
      StorePercentUsage:
        metric: disc.StorePercentUsage
        desc: The percentage of configured disk used for persistent messages
      TempPercentUsage:
        metric: disc.TempPercentUsage
        desc: The percentage of configured disk used for non-persistent messages
