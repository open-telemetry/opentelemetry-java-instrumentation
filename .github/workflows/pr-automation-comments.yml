name: PR Automation Comments
on:
  pull_request_target:
    types: [labeled]

permissions:
  pull-requests: write

jobs:
  comment-on-breaking-change:
    if: contains(github.event.label.name, 'breaking change')
    runs-on: ubuntu-latest
    steps:
      - name: Comment on PR
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
            });

            // Check if we've already commented about breaking changes
            const botComment = comments.find(comment => 
              comment.user.login === 'github-actions[bot]' && 
              comment.body.includes('âš ï¸ Breaking Change Documentation Required')
            );

            if (!botComment) {
              const commentBody = [
                "## âš ï¸ Breaking Change Documentation Required",
                "",
                "This PR has been labeled as a **breaking change**. Please ensure you provide the following information:",
                "",
                "### Migration Notes Required",
                "Please add detailed migration notes to help users understand:",
                "- What is changing and why",
                "- How to update their code/configuration", 
                "- Any alternative approaches if applicable",
                "- Code examples showing before/after usage",
                "",
                "### Checklist",
                "- Migration notes added to the PR description",
                "- Breaking change is documented in the "Unreleased" section of the [Changelog](https://github.com/open-telemetry/opentelemetry-java-instrumentation/blob/main/CHANGELOG.md), preferably as part of this PR.",
                "- Consider if this change requires a major version bump",
                "",
                "Your migration notes will be included in the release notes to help users upgrade smoothly. The more detailed and helpful they are, the better the user experience will be.",
                "",
                "---",
                "*This comment was automatically generated because the `breaking change` label was applied to this PR.*"
              ].join("\n");

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: commentBody
              });
            }

  comment-on-deprecation:
    if: contains(github.event.label.name, 'deprecation')
    runs-on: ubuntu-latest
    steps:
      - name: Comment on PR
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8.0.0
        with:
          script: |
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
            });

            // Check if we've already commented about deprecation
            const botComment = comments.find(comment => 
              comment.user.login === 'github-actions[bot]' && 
              comment.body.includes('ğŸ“‹ Deprecation Notice')
            );

            if (!botComment) {
              const commentBody = [
                "## ğŸ“‹ Deprecation Notice",
                "",
                "This PR has been labeled as a **deprecation**. Please ensure you provide the following information:",
                "",
                "### ğŸ“ Deprecation Details Required",
                "Please add details to help users understand:",
                "- What is being deprecated and why",
                "- What should be used instead (if applicable)",
                "- Timeline for removal (if known)",
                "- Any migration guidance",
                "",
                "### ğŸ“‹ Checklist",
                "- [ ] Deprecation details added to the PR description",
                "- [ ] Deprecation is documented in the changelog entry for the next release",
                "- [ ] Consider adding deprecation warnings in code/documentation",
                "",
                "Your deprecation notes will be included in the release notes to help users prepare for future changes.",
                "",
                "---",
                "*This comment was automatically generated because the `deprecation` label was applied to this PR.*"
              ].join("\n");

              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: commentBody
              });
            }
